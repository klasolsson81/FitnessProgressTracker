# .github/workflows/discord-notifications.yml
name: Discord Notiser

on:
  pull_request:
    types: [opened, reopened, ready_for_review]

  workflow_run:
    workflows: [".NET Build and Test"]
    types:
      - completed

jobs:
  notify_pr:
    name: Skicka PR Notis
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
      - name: Skicka Discord-notis om ny PR
        uses: Ilshidur/action-discord@0.3.0
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          # R√ÑTT SYNTAX: Anv√§nd separata f√§lt ist√§llet f√∂r ett JSON-objekt
          content: "üôã‚Äç‚ôÄÔ∏è Ny Pull Request! Dags att granska!"
          embed: |
            {
              "title": "${{ github.event.pull_request.title }} (#${{ github.event.pull_request.number }})",
              "description": "Fr√•n: **${{ github.actor }}**\nGren: `${{ github.event.pull_request.head.ref }}`",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 16766720
            }

  notify_build_status:
    name: Skicka Byggstatus
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_run'
    
    steps:
      - name: Skicka notis om lyckat bygge
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        uses: Ilshidur/action-discord@0.3.0
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          content: "‚úÖ Bygge lyckades!"
          embed: |
            {
              "title": "Workflow `${{ github.event.workflow_run.name }}` lyckades",
              "description": "K√∂rdes p√• grenen `${{ github.event.workflow_run.head_branch }}` av **${{ github.actor }}**.",
              "url": "${{ github.event.workflow_run.html_url }}",
              "color": 3066993
            }

      - name: Skicka notis om misslyckat bygge
        if: ${{ github.event.workflow_run.conclusion == 'failure' }}
        uses: Ilshidur/action-discord@0.3.0
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          content: "üö® **BYGGE MISSLYCKADES** üö®"
          embed: |
            {
              "title": "Workflow `${{ github.event.workflow_run.name }}` misslyckades",
              "description": "K√∂rdes p√• grenen `${{ github.event.workflow_run.head_branch }}` av **${{ github.actor }}**. \n**V√§nligen kolla loggarna!**",
              "url": "${{ github.event.workflow_run.html_url }}",
              "color": 15158332
            }
