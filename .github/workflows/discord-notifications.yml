# .github/workflows/discord-notifications.yml
name: Discord Notiser

on:
  pull_request:
    types: [opened, reopened, ready_for_review]

  workflow_run:
    # ‚ùóÔ∏è Kom ih√•g att denna m√•ste matcha namnet fr√•n dotnet-build.yml
    workflows: [".NET Build and Test"] 
    types:
      - completed

jobs:
  notify_pr:
    name: Skicka PR Notis
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
      - name: Skicka Discord-notis om ny PR
        # --- VIKTIG √ÑNDRING H√ÑR ---
        # Vi byter till en ny, tydligare action
        uses: lovai/discord-webhook-action@v1
        with:
          # Den tar webhooken som en direkt parameter
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          # 'content' √§r en egen parameter
          content: "üôã‚Äç‚ôÄÔ∏è Ny Pull Request! Dags att granska!"
          # 'embeds' √§r en egen parameter d√§r vi l√§gger v√•r JSON
          embeds: |
            [
              {
                "title": "${{ github.event.pull_request.title }} (#${{ github.event.pull_request.number }})",
                "description": "Fr√•n: **${{ github.actor }}**\nGren: `${{ github.event.pull_request.head.ref }}`",
                "url": "${{ github.event.pull_request.html_url }}",
                "color": 16766720
              }
            ]

  notify_build_status:
    name: Skicka Byggstatus
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_run'
    
    steps:
      - name: Skicka notis om lyckat bygge
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        # --- VIKTIG √ÑNDRING H√ÑR ---
        uses: lovai/discord-webhook-action@v1
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          content: "‚úÖ Bygge lyckades!"
          embeds: |
            [
              {
                "title": "Workflow `${{ github.event.workflow_run.name }}` lyckades",
                "description": "K√∂rdes p√• grenen `${{ github.event.workflow_run.head_branch }}` av **${{ github.actor }}**.",
                "url": "${{ github.event.workflow_run.html_url }}",
                "color": 3066993
              }
            ]

      - name: Skicka notis om misslyckat bygge
        if: ${{ github.event.workflow_run.conclusion == 'failure' }}
        # --- VIKTIG √ÑNDRING H√ÑR ---
        uses: lovai/discord-webhook-action@v1
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          content: "üö® **BYGGE MISSLYCKADES** üö®"
          embeds: |
            [
              {
                "title": "Workflow `${{ github.event.workflow_run.name }}` misslyckades",
                "description": "K√∂rdes p√• grenen `${{ github.event.workflow_run.head_branch }}` av **${{ github.actor }}**. \n**V√§nligen kolla loggarna!**",
                "url": "${{ github.event.workflow_run.html_url }}",
                "color": 15158332
              }
            ]
